<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-redis/history.base">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ovimCloud RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ovimCloud Atom Feed">
<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?e41c66eb0d1e156cedfb6c839d5a7714",e.defer=!0;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="code-UW7yi5Jgyu">
<script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",t.defer=!0;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><title data-rh="true">基础 | ovimCloud</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://ovim.cloud/docs/redis/history.base"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="基础 | ovimCloud"><meta data-rh="true" name="description" content="安装"><meta data-rh="true" property="og:description" content="安装"><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="http://ovim.cloud/docs/redis/history.base"><link data-rh="true" rel="alternate" href="http://ovim.cloud/docs/redis/history.base" hreflang="en"><link data-rh="true" rel="alternate" href="http://ovim.cloud/docs/redis/history.base" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.4817b0eb.css">
<link rel="preload" href="/assets/js/runtime~main.3df1fd9e.js" as="script">
<link rel="preload" href="/assets/js/main.c7718077.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/favicon.svg" alt="ovimCloud" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/favicon.svg" alt="ovimCloud" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">ovimCloud</b></a><a class="navbar__item navbar__link" href="/case">SiteMap</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/version-control/intro">Version control</a></li><li><a class="dropdown__link" href="/docs/docker/intro">Docker</a></li><li><a class="dropdown__link" href="/docs/linux/intro">Linux</a></li><li><a class="dropdown__link" href="/docs/nginx/intro">Nginx</a></li><li><a class="dropdown__link" href="/docs/sql/intro">SQL</a></li><li><a class="dropdown__link" href="/docs/php/intro">PHP</a></li><li><a class="dropdown__link" href="/docs/go/intro">Go</a></li><li><a class="dropdown__link" href="/docs/algorithm/base">算法</a></li><li><a class="dropdown__link" href="/docs/aliyun/ali-sms">第三方平台</a></li></ul></div><a href="https://github.com/ovim" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><main class="docMainContainer_TCnq docMainContainerEnhanced_WDCb"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>基础</h1></header><h2 class="anchor anchorWithStickyNavbar_mojV" id="安装">安装<a class="hash-link" href="#安装" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="linux">Linux<a class="hash-link" href="#linux" title="Direct link to heading">​</a></h3><h2 class="anchor anchorWithStickyNavbar_mojV" id="数据类型">数据类型<a class="hash-link" href="#数据类型" title="Direct link to heading">​</a></h2><blockquote><p>Redis支持五种数据类型：string(字符串)、hash(哈希)、list(列表)、set(集合)、zset(sorted set：有序集合)</p></blockquote><h3 class="anchor anchorWithStickyNavbar_mojV" id="string字符串">String（字符串）<a class="hash-link" href="#string字符串" title="Direct link to heading">​</a></h3><p>string 是 redis 最基本的类型，你可以理解成与 Memcached 一模一样的类型，一个 key 对应一个 value。</p><p>string 类型是二进制安全的。意思是 redis 的 string 可以包含任何数据。比如jpg图片或者序列化的对象。</p><p>string 类型是 Redis 最基本的数据类型，string 类型的值最大能存储 512MB。</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">redis </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> SET name </span><span class="token string" style="color:#e3116c">&quot;runoob&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> GET name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&quot;runoob&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>在以上实例中我们使用了 Redis 的 SET 和 GET 命令。键为 name，对应的值为 runoob。</p><p><strong>注意:</strong>一个键最大能存储512MB。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="hash哈希">Hash（哈希）<a class="hash-link" href="#hash哈希" title="Direct link to heading">​</a></h3><p>Redis hash 是一个键值(key=&gt;value)对集合。</p><p>Redis hash 是一个 string 类型的 field 和 value 的映射表，hash 特别适合用于存储对象。</p><p>实例
DEL runoob 用于删除前面测试用过的 key，不然会报错：<code>(error) WRONGTYPE Operation against a key holding the wrong kind of value</code></p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">redis </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> DEL runoob</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> HMSET myhash field1 </span><span class="token string" style="color:#e3116c">&quot;Hello&quot;</span><span class="token plain"> field2 </span><span class="token string" style="color:#e3116c">&quot;World&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&quot;OK&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> HGET myhash field1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&quot;Hello&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> HGET myhash field2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&quot;World&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>实例中我们使用了 Redis HMSET, HGET 命令，HMSET 设置了两个 field=&gt;value 对, HGET 获取对应 field 对应的 value。</p><p>每个 hash 可以存储 $2^32$ -1 键值对（40多亿即2的32次方-1）。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="list列表">List（列表）<a class="hash-link" href="#list列表" title="Direct link to heading">​</a></h3><p>Redis 列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边 lpush ）或者尾部（右边 rpush ）。</p><p>实例</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">redis </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> DEL runoob</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> lpush runoob redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">integer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> lpush runoob mongodb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">integer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> lpush runoob rabitmq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">integer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> lrange runoob </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rabitmq&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;mongodb&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;redis&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>列表最多可存储 232 - 1 元素 (4294967295, 每个列表可存储40多亿)。　　</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="set集合">Set（集合）<a class="hash-link" href="#set集合" title="Direct link to heading">​</a></h3><p>Redis的Set是string类型的无序集合。</p><p>集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是O(1)。</p><p>sadd 命令
添加一个 string 元素到 key 对应的 set 集合中，成功返回1，如果元素已经在集合中返回 0，如果 key 对应的 set 不存在则返回错误。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">sadd key member</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>实例</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">redis </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> DEL runoob</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> sadd runoob redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">integer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> sadd runoob mongodb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">integer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> sadd runoob rabitmq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">integer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> sadd runoob rabitmq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">integer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> smembers runoob</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">1) &quot;redis&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2) &quot;rabitmq&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3) &quot;mongodb&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>注意：以上实例中 rabitmq 添加了两次，但根据集合内元素的唯一性，第二次插入的元素将被忽略。</p><p>集合中最大的成员数为 232 - 1(4294967295, 每个集合可存储40多亿个成员)。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="zsetsorted-set有序集合">zset(sorted set：有序集合)<a class="hash-link" href="#zsetsorted-set有序集合" title="Direct link to heading">​</a></h3><p>Redis zset 和 set 一样也是string类型元素的集合,且不允许重复的成员。</p><p>不同的是每个元素都会关联一个double类型的分数。redis正是通过分数来为集合中的成员进行从小到大的排序。</p><p>zset的成员是唯一的,但分数(score)却可以重复。 </p><p>zadd 命令
添加元素到集合，元素在集合中存在则更新对应score</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zadd key score member</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>实例</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">redis </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> DEL runoob</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> zadd runoob </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">integer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> zadd runoob </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> mongodb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">integer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> zadd runoob </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> rabitmq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">integer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> zadd runoob </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> rabitmq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">integer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> ZRANGEBYSCORE runoob </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">1) &quot;mongodb&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2) &quot;rabitmq&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3) &quot;redis&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>参考教程：<a href="https://www.runoob.com/redis/redis-data-types.html" target="_blank" rel="noopener noreferrer">https://www.runoob.com/redis/redis-data-types.html</a>   </p><h2 class="anchor anchorWithStickyNavbar_mojV" id="命令汇总">命令汇总<a class="hash-link" href="#命令汇总" title="Direct link to heading">​</a></h2><blockquote><ol><li>基于内存的key-value数据库</li><li>基于c语言编写的，可以支持多种语言的api //set每秒11万次，取get 81000次</li><li>支持数据持久化</li><li>value可以是string，hash， list， set, sorted set</li></ol></blockquote><blockquote><p>使用场景</p><ol><li>去最新n个数据的操作</li><li>排行榜，取top n个数据 //最佳人气前10条</li><li>精确的设置过期时间</li><li>计数器</li><li>实时系统， 反垃圾系统</li><li>pub， sub发布订阅构建实时消息系统</li><li>构建消息队列</li><li>缓存</li></ol></blockquote><p>终端访问redis
<code>redis-cli</code></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="key">key<a class="hash-link" href="#key" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">    keys * 获取所有的key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> 选择第一个库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    move myString </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> 将当前的数据库key移动到某个数据库,目标库有，则不能移动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    flush db      清除指定库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    randomkey     随机key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">type</span><span class="token plain"> key      类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">set</span><span class="token plain"> key1 value1 设置key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    get key1    获取key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mset key1 value1 key2 value2 key3 value3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mget key1 key2 key3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    del key1   删除key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exists key      判断是否存在key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    expire key </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">过期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pexpire key </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"> 毫秒</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    persist key     删除过期时间</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="string">string<a class="hash-link" href="#string" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">set</span><span class="token plain"> name cxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    get name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    getrange name </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> -1        字符串分段</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    getset name new_cxx       设置值，返回旧值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mset key1 key2            批量设置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mget key1 key2            批量获取</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    setnx key value           不存在就插入（not exists）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    setex key </span><span class="token function" style="color:#d73a49">time</span><span class="token plain"> value      过期时间（expire）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    setrange key index value  从index开始替换value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    incr age        递增</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    incrby age </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">   递增</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    decr age        递减</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    decrby age </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">   递减</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    incrbyfloat     增减浮点数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    append          追加</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    strlen          长度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    getbit/setbit/bitcount/bitop    位操作</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="hash">hash<a class="hash-link" href="#hash" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">    hset myhash name cxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hget myhash name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hmset myhash name cxx age </span><span class="token number" style="color:#36acaa">25</span><span class="token plain"> note </span><span class="token string" style="color:#e3116c">&quot;i am notes&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hmget myhash name age note   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hgetall myhash               获取所有的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hexists myhash name          是否存在</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hsetnx myhash score </span><span class="token number" style="color:#36acaa">100</span><span class="token plain">      设置不存在的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hincrby myhash </span><span class="token function" style="color:#d73a49">id</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">          递增</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hdel myhash name             删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hkeys myhash                 只取key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hvals myhash                 只取value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hlen myhash                  长度</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="list">list<a class="hash-link" href="#list" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">    lpush mylist a b c  左插入</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rpush mylist x y z  右插入</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lrange mylist </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> -1  数据集合</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lpop mylist  弹出元素</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rpop mylist  弹出元素</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    llen mylist  长度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lrem mylist count value  删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lindex mylist </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">          指定索引的值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lset mylist </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> n          索引设值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ltrim mylist </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">         删除key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    linsert mylist before a  插入</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    linsert mylist after a   插入</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rpoplpush list list2     转移列表的数据</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="set">set<a class="hash-link" href="#set" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">    sadd myset redis </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    smembers myset       数据集合</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    srem myset set1         删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sismember myset set1 判断元素是否在集合中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    scard key_name       个数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sdiff</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> sinter </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> sunion 操作：集合间运算：差集 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> 交集 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> 并集</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    srandmember          随机获取集合中的元素</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spop                 从集合中弹出一个元素</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="zset">zset<a class="hash-link" href="#zset" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">    zadd zset </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> one</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    zadd zset </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> two</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    zadd zset </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> three</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    zincrby zset </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> one              增长分数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    zscore zset two                 获取分数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    zrange zset </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> -1 withscores     范围值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    zrangebyscore zset </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">25</span><span class="token plain"> withscores 指定范围的值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    zrangebyscore zset </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">25</span><span class="token plain"> withscores limit </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> 分页</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Zrevrangebyscore zset </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">25</span><span class="token plain"> withscores  指定范围的值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    zcard zset  元素数量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Zcount zset 获得指定分数范围内的元素个数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Zrem zset one two        删除一个或多个元素</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Zremrangebyrank zset </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">  按照排名范围删除元素</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Zremrangebyscore zset </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> 按照分数范围删除元素</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Zrank zset </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> -1    分数最小的元素排名为0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Zrevrank zset </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> -1  分数最大的元素排名为0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Zinterstore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    zunionstore rank:last_week </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> rank:20150323 rank:20150324 rank:20150325  weights </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="排序">排序：<a class="hash-link" href="#排序" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sort</span><span class="token plain"> mylist  排序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sort</span><span class="token plain"> mylist alpha desc limit </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> 字母排序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sort</span><span class="token plain"> list by it:* desc           by命令</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sort</span><span class="token plain"> list by it:* desc get it:*  get参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sort</span><span class="token plain"> list by it:* desc get it:* store sorc:result  sort命令之store参数：表示把sort查询的结果集保存起来</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="订阅与发布">订阅与发布：<a class="hash-link" href="#订阅与发布" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">订阅频道：subscribe chat1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">发布消息：publish chat1 &quot;hell0 ni hao&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查看频道：pubsub channels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查看某个频道的订阅者数量: pubsub numsub chat1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">退订指定频道： unsubscrible chat1   , punsubscribe java.*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">订阅一组频道： psubscribe java.*</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="redis事务">redis事务：<a class="hash-link" href="#redis事务" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"> 隔离性，原子性， </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 步骤：  开始事务，执行命令，提交事务</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         multi  //开启事务</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         sadd myset a b c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         sadd myset e f g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         lpush mylist aa bb cc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         lpush mylist dd ff gg</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="服务器管理">服务器管理<a class="hash-link" href="#服务器管理" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">dump.rdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">appendonly.aof</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//BgRewriteAof 异步执行一个aop(appendOnly file)文件重写</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">会创建当前一个AOF文件体积的优化版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//BgSave 后台异步保存数据到磁盘，会在当前目录下创建文件dump.rdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//save同步保存数据到磁盘，会阻塞主进程，别的客户端无法连接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//client kill 关闭客户端连接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//client list 列出所有的客户端</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//给客户端设置一个名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client setname myclient1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client getname</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> config get port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> //configRewrite 对redis的配置文件进行改写</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>rdb </p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">save 900 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">save 300 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">save 60 10000</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>aop备份处理</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">appendonly yes    开启持久化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">appendfsync everysec  每秒备份一次</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>命令：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">bgsave异步保存数据到磁盘（快照保存）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lastsave返回上次成功保存到磁盘的unix的时间戳</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shutdown同步保存到服务器并关闭redis服务器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bgrewriteaof文件压缩处理（命令）</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="常见的使用场景">常见的使用场景<a class="hash-link" href="#常见的使用场景" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="简单字符串缓存实战">简单字符串缓存实战<a class="hash-link" href="#简单字符串缓存实战" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT language-php theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-php codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;connect(&#x27;127.0.0.1&#x27;, 6379);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$strCacheKey  = &#x27;Test_bihu&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//SET 应用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$arrCacheData = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;name&#x27; =&gt; &#x27;job&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;sex&#x27;  =&gt; &#x27;男&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;age&#x27;  =&gt; &#x27;30&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;set($strCacheKey, json_encode($arrCacheData));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;expire($strCacheKey, 30);  # 设置30秒后过期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$json_data = $redis-&gt;get($strCacheKey);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$data = json_decode($json_data);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print_r($data-&gt;age); //输出数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//HSET 应用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$arrWebSite = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;google&#x27; =&gt; [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;google.com&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;google.com.hk&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;hSet($strCacheKey, &#x27;google&#x27;, json_encode($arrWebSite[&#x27;google&#x27;]));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$json_data = $redis-&gt;hGet($strCacheKey, &#x27;google&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$data = json_decode($json_data);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print_r($data); //输出数据</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="简单队列缓存实战">简单队列缓存实战<a class="hash-link" href="#简单队列缓存实战" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT language-php theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-php codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;connect(&#x27;127.0.0.1&#x27;, 6379);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$strQueueName  = &#x27;Test_bihu_queue&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//进队列</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;rpush($strQueueName, json_encode([&#x27;uid&#x27; =&gt; 1,&#x27;name&#x27; =&gt; &#x27;Job&#x27;]));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;rpush($strQueueName, json_encode([&#x27;uid&#x27; =&gt; 2,&#x27;name&#x27; =&gt; &#x27;Tom&#x27;]));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;rpush($strQueueName, json_encode([&#x27;uid&#x27; =&gt; 3,&#x27;name&#x27; =&gt; &#x27;John&#x27;]));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;---- 进队列成功 ---- &lt;br /&gt;&lt;br /&gt;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//查看队列</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$strCount = $redis-&gt;lrange($strQueueName, 0, -1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;当前队列数据为： &lt;br /&gt;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print_r($strCount);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//出队列</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;lpop($strQueueName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;&lt;br /&gt;&lt;br /&gt; ---- 出队列成功 ---- &lt;br /&gt;&lt;br /&gt;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//查看队列</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$strCount = $redis-&gt;lrange($strQueueName, 0, -1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;当前队列数据为： &lt;br /&gt;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print_r($strCount);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="简单发布订阅实战">简单发布订阅实战<a class="hash-link" href="#简单发布订阅实战" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT language-php theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-php codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">//以下是 pub.php 文件的内容 cli下运行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ini_set(&#x27;default_socket_timeout&#x27;, -1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;connect(&#x27;127.0.0.1&#x27;, 6379);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$strChannel = &#x27;Test_bihu_channel&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//发布</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;publish($strChannel, &quot;来自{$strChannel}频道的推送&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;---- {$strChannel} ---- 频道消息推送成功～ &lt;br/&gt;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;close();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// -------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//以下是 sub.php 文件内容 cli下运行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ini_set(&#x27;default_socket_timeout&#x27;, -1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;connect(&#x27;127.0.0.1&#x27;, 6379);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$strChannel = &#x27;Test_bihu_channel&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//订阅</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;---- 订阅{$strChannel}这个频道，等待消息推送...----  &lt;br/&gt;&lt;br/&gt;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;subscribe([$strChannel], &#x27;callBackFun&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function callBackFun($redis, $channel, $msg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print_r([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;redis&#x27;   =&gt; $redis,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;channel&#x27; =&gt; $channel,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;msg&#x27;     =&gt; $msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="简单计数器实战">简单计数器实战<a class="hash-link" href="#简单计数器实战" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT language-php theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-php codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;connect(&#x27;127.0.0.1&#x27;, 6379);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$strKey = &#x27;Test_bihu_comments&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//设置初始值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;set($strKey, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;INCR($strKey);  //+1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;INCR($strKey);  //+1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;INCR($strKey);  //+1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$strNowCount = $redis-&gt;get($strKey);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;---- 当前数量为{$strNowCount}。 ---- &quot;;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="排行榜实战">排行榜实战<a class="hash-link" href="#排行榜实战" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT language-php theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-php codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;connect(&#x27;127.0.0.1&#x27;, 6379);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$strKey = &#x27;Test_bihu_score&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//存储数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;zadd($strKey, &#x27;50&#x27;, json_encode([&#x27;name&#x27; =&gt; &#x27;Tom&#x27;]));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;zadd($strKey, &#x27;70&#x27;, json_encode([&#x27;name&#x27; =&gt; &#x27;John&#x27;]));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;zadd($strKey, &#x27;90&#x27;, json_encode([&#x27;name&#x27; =&gt; &#x27;Jerry&#x27;]));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;zadd($strKey, &#x27;30&#x27;, json_encode([&#x27;name&#x27; =&gt; &#x27;Job&#x27;]));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;zadd($strKey, &#x27;100&#x27;, json_encode([&#x27;name&#x27; =&gt; &#x27;LiMing&#x27;]));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$dataOne = $redis-&gt;ZREVRANGE($strKey, 0, -1, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;---- {$strKey}由大到小的排序 ---- &lt;br /&gt;&lt;br /&gt;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print_r($dataOne);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$dataTwo = $redis-&gt;ZRANGE($strKey, 0, -1, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;&lt;br /&gt;&lt;br /&gt;---- {$strKey}由小到大的排序 ---- &lt;br /&gt;&lt;br /&gt;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print_r($dataTwo);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="简单字符串悲观锁实战">简单字符串悲观锁实战<a class="hash-link" href="#简单字符串悲观锁实战" title="Direct link to heading">​</a></h3><p>解释：悲观锁(Pessimistic Lock), 顾名思义，就是很悲观。</p><p>每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁。</p><p>场景：如果项目中使用了缓存且对缓存设置了超时时间。</p><p>当并发量比较大的时候，如果没有锁机制，那么缓存过期的瞬间，</p><p>大量并发请求会穿透缓存直接查询数据库，造成雪崩效应。</p><div class="codeBlockContainer_I0IT language-php theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-php codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 获取锁</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @param  String  $key    锁标识</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @param  Int     $expire 锁过期时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @return Boolean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public function lock($key = &#x27;&#x27;, $expire = 5) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $is_lock = $this-&gt;_redis-&gt;setnx($key, time()+$expire);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //不能获取锁</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if(!$is_lock){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //判断锁是否过期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $lock_time = $this-&gt;_redis-&gt;get($key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //锁已过期，删除锁，重新获取</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (time() &gt; $lock_time) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            unlock($key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $is_lock = $this-&gt;_redis-&gt;setnx($key, time() + $expire);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return $is_lock? true : false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 释放锁</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @param  String  $key 锁标识</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @return Boolean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public function unlock($key = &#x27;&#x27;){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return $this-&gt;_redis-&gt;del($key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 定义锁标识</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$key = &#x27;Test_bihu_lock&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 获取锁</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$is_lock = lock($key, 10);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ($is_lock) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &#x27;get lock success&lt;br&gt;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &#x27;do sth..&lt;br&gt;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sleep(5);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &#x27;success&lt;br&gt;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unlock($key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else { //获取锁失败</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &#x27;request too frequently&lt;br&gt;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="简单事务的乐观锁实战">简单事务的乐观锁实战<a class="hash-link" href="#简单事务的乐观锁实战" title="Direct link to heading">​</a></h3><p>解释：乐观锁(Optimistic Lock), 顾名思义，就是很乐观。</p><p>每次去拿数据的时候都认为别人不会修改，所以不会上锁。</p><p>watch命令会监视给定的key，当exec时候如果监视的key从调用watch后发生过变化，则整个事务会失败。</p><p>也可以调用watch多次监视多个key。这样就可以对指定的key加乐观锁了。</p><p>注意watch的key是对整个连接有效的，事务也一样。</p><p>如果连接断开，监视和事务都会被自动清除。</p><p>当然了exec，discard，unwatch命令都会清除连接中的所有监视。</p><div class="codeBlockContainer_I0IT language-php theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-php codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$strKey = &#x27;Test_bihu_age&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;set($strKey,10);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$age = $redis-&gt;get($strKey);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;---- Current Age:{$age} ---- &lt;br/&gt;&lt;br/&gt;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;watch($strKey);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 开启事务</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;multi();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//在这个时候新开了一个新会话执行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;set($strKey,30);  //新会话</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;---- Current Age:{$age} ---- &lt;br/&gt;&lt;br/&gt;&quot;; //30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;set($strKey,20);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$redis-&gt;exec();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$age = $redis-&gt;get($strKey);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;---- Current Age:{$age} ---- &lt;br/&gt;&lt;br/&gt;&quot;; //30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//当exec时候如果监视的key从调用watch后发生过变化，则整个事务会失败</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#安装" class="table-of-contents__link toc-highlight">安装</a><ul><li><a href="#linux" class="table-of-contents__link toc-highlight">Linux</a></li></ul></li><li><a href="#数据类型" class="table-of-contents__link toc-highlight">数据类型</a><ul><li><a href="#string字符串" class="table-of-contents__link toc-highlight">String（字符串）</a></li><li><a href="#hash哈希" class="table-of-contents__link toc-highlight">Hash（哈希）</a></li><li><a href="#list列表" class="table-of-contents__link toc-highlight">List（列表）</a></li><li><a href="#set集合" class="table-of-contents__link toc-highlight">Set（集合）</a></li><li><a href="#zsetsorted-set有序集合" class="table-of-contents__link toc-highlight">zset(sorted set：有序集合)</a></li></ul></li><li><a href="#命令汇总" class="table-of-contents__link toc-highlight">命令汇总</a><ul><li><a href="#key" class="table-of-contents__link toc-highlight">key</a></li><li><a href="#string" class="table-of-contents__link toc-highlight">string</a></li><li><a href="#hash" class="table-of-contents__link toc-highlight">hash</a></li><li><a href="#list" class="table-of-contents__link toc-highlight">list</a></li><li><a href="#set" class="table-of-contents__link toc-highlight">set</a></li><li><a href="#zset" class="table-of-contents__link toc-highlight">zset</a></li><li><a href="#排序" class="table-of-contents__link toc-highlight">排序：</a></li><li><a href="#订阅与发布" class="table-of-contents__link toc-highlight">订阅与发布：</a></li><li><a href="#redis事务" class="table-of-contents__link toc-highlight">redis事务：</a></li><li><a href="#服务器管理" class="table-of-contents__link toc-highlight">服务器管理</a></li></ul></li><li><a href="#常见的使用场景" class="table-of-contents__link toc-highlight">常见的使用场景</a><ul><li><a href="#简单字符串缓存实战" class="table-of-contents__link toc-highlight">简单字符串缓存实战</a></li><li><a href="#简单队列缓存实战" class="table-of-contents__link toc-highlight">简单队列缓存实战</a></li><li><a href="#简单发布订阅实战" class="table-of-contents__link toc-highlight">简单发布订阅实战</a></li><li><a href="#简单计数器实战" class="table-of-contents__link toc-highlight">简单计数器实战</a></li><li><a href="#排行榜实战" class="table-of-contents__link toc-highlight">排行榜实战</a></li><li><a href="#简单字符串悲观锁实战" class="table-of-contents__link toc-highlight">简单字符串悲观锁实战</a></li><li><a href="#简单事务的乐观锁实战" class="table-of-contents__link toc-highlight">简单事务的乐观锁实战</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://www.cnblogs.com/ovim/" target="_blank" rel="noopener noreferrer" class="footer__link-item">cnblogs.com<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/ovim" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://space.bilibili.com/315847004" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bilibili<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Links</div><ul class="footer__items"><li class="footer__item"><a href="https://blog.csdn.net/weixin_45566227" target="_blank" rel="noopener noreferrer" class="footer__link-item">xiaonizi️<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.shx1024.top/" target="_blank" rel="noopener noreferrer" class="footer__link-item">huixin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://blog.csdn.net/qq_42249896/" target="_blank" rel="noopener noreferrer" class="footer__link-item">guangtouqiang<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Links</div><ul class="footer__items"><li class="footer__item"><a href="https://www.cnblogs.com/guangzan/" target="_blank" rel="noopener noreferrer" class="footer__link-item">guangzan<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.cnblogs.com/fanzhen/" target="_blank" rel="noopener noreferrer" class="footer__link-item">fanzhen<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
                    Copyright © 2022 ovim, Inc. 
                    Built with Docusaurus. 
                    <a href="https://storyset.com/home" target="__blank">Home illustrations by Storyset</a>
                    <p>
                        <a href="http://beian.miit.gov.cn/" target="__blank">鲁ICP备2021002124号-1
                        </a>
                    </p>
                    <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="__blank">
                        <img alt="Creative Commons License" style="border-width:0" src="/img/creative-commons-license-icon.png">
                    </a>
                    <br>
                    本站所有内容遵循 
                        <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/deed.zh-Hans" target="__blank">CC BY-NC 4.0 协议
                        </a>，转载须注明署名和出处，且不可用于商业用途。若与其他同步平台协议冲突，以本网站为准。
                </div></div></div></footer></div>
<script src="/assets/js/runtime~main.3df1fd9e.js"></script>
<script src="/assets/js/main.c7718077.js"></script>
</body>
</html>